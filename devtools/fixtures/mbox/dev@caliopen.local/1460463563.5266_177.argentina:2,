Received: from list by lists.gnu.org with archive (Exim 4.71)
	id 1apFvg-00049M-Ob
	for mharc-dev@caliopen.local; Sun, 10 Apr 2016 10:01:32 -0400
Received: from eggs.gnu.org ([2001:4830:134:3::10]:34471)
	by lists.gnu.org with esmtp (Exim 4.71)
	(envelope-from <clement.pit@gmail.com>) id 1apFvd-00045Q-Hp
	for dev@caliopen.local; Sun, 10 Apr 2016 10:01:30 -0400
Received: from Debian-exim by eggs.gnu.org with spam-scanned (Exim 4.71)
	(envelope-from <clement.pit@gmail.com>) id 1apFvc-0000QR-IX
	for dev@caliopen.local; Sun, 10 Apr 2016 10:01:29 -0400
Received: from mout.kundenserver.de ([212.227.126.130]:64333)
	by eggs.gnu.org with esmtp (Exim 4.71)
	(envelope-from <clement.pit@gmail.com>)
	id 1apFvY-0000Q8-LK; Sun, 10 Apr 2016 10:01:24 -0400
Received: from [18.189.83.142] ([18.189.83.142]) by mrelayeu.kundenserver.de
	(mreue001) with ESMTPSA (Nemesis) id 0LbDeU-1bUfTl0DAA-00kwJV;
	Sun, 10 Apr 2016 16:01:23 +0200
Subject: Re: How do I set up font fallback in a robust way?
To: Eli Zaretskii <eliz@gnu.org>
References: <570954AA.7070604@gmail.com> <834mbain03.fsf@gnu.org>
	<57095F97.4060305@gmail.com> <83y48mgp1x.fsf@gnu.org>
Cc: dev@caliopen.local
From: =?UTF-8?Q?Cl=c3=a9ment_Pit--Claudel?= <clement.pit@gmail.com>
Message-ID: <570A5CB0.8070107@gmail.com>
Date: Sun, 10 Apr 2016 10:01:20 -0400
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:38.0) Gecko/20100101
	Thunderbird/38.6.0
MIME-Version: 1.0
In-Reply-To: <83y48mgp1x.fsf@gnu.org>
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature";
	boundary="Pb3T24QuA6MJiaxIv2t2eSkgJlNRxanfS"
X-Provags-ID: V03:K0:2tjQw5RdxwVtIlufA37xKutrKWHGPdJNBiGG3YqGOavxJ4B/2OO
	QIHlgDqVLqyTj9BdtsqsK8PwY7gYYqyMHRM3FaDWsCvPq7Ez66HIuMYyu82B5NgdpWngQpL
	XKHYMI7zLLKV3J3j4S5zs8nCS+DY7IqaJeuSHPC8gSJ7Y6Vv7Z6bpiNz2Z+Wk/mSWiTWZd8
	pPxkj+6EpBThlJD1/Q+JQ==
X-UI-Out-Filterresults: notjunk:1;V01:K0:w0qVUuJK8cU=://8Fx3s1quQ/6moSWJr/L6
	qJZmr7maaGDm7iF1I27OBaa1nwri5FWfCJvb6/65EMip07V/7Oepswm1Wx9qiq/8UN48djlHg
	q8HhpCd/+FPE/eQf8K7Jz9IJhGlLlH0EwJQBGrVLkP0SefYluJ6ruTjX6xYFCBY6vcuGndUnZ
	dwpflox+lKMhaqRIxacvmSkxrzFUk7h8Hv+HmyzHn6IHfuu7z6NYOiqsM8Qzx/gpWkLuKaXne
	LZgY0vbNACkwvn+Glr2mFab09deBGOD4k9i8xNxFaOIOL5/JYAQ5wdah6N98FiWf3ECI78KhM
	G06tjz8cKURl4f9dw1v6DXYeMUwFIUOXqGcPNGb0vfpSQ0py0BbzgFnJt4RF/zZFHjHPvguCp
	uxomhxFQWsE4o/cWjjkfKt6JnAILKD4+SaAYlPYIli3axq4Z4Lg4EP44k7ioUPT/g91S3JS1m
	Qgo1GO9bJFI8RlHZQNQPS17xRba6OrkOvFlajFbdG1Uuvm9XsR8yZR3InK1tAz0afauyI1Ym+
	Ik01Hi7EE2VGCYfdrnV4avzbCakB88nqtrN2ZW6wpe6T2e/r+E4Qs8P+F7jYx7Wmj5q+GfaQT
	GPgSmuy9br1P57dRFMH1oqQfMSboI9m6BN14EkpGnYuiWnWyuJZQdGC1mrQAT+AIaBkJQ/P3s
	Wfmdw8aaOXxfNsGMOQT1jhcE70xSquUtfUyzcMri5sWW6r3AMDqOHxBz7ulK6AvEbwXQ=
X-detected-operating-system: by eggs.gnu.org: GNU/Linux 2.2.x-3.x [generic]
X-Received-From: 212.227.126.130
X-BeenThere: emacs-devel@gnu.org
X-Mailman-Version: 2.1.21
Precedence: list
List-Id: "Emacs development discussions." <emacs-devel.gnu.org>
List-Unsubscribe: <https://lists.gnu.org/mailman/options/emacs-devel>,
	<mailto:emacs-devel-request@gnu.org?subject=unsubscribe>
List-Archive: <http://lists.gnu.org/archive/html/emacs-devel/>
List-Post: <mailto:emacs-devel@gnu.org>
List-Help: <mailto:emacs-devel-request@gnu.org?subject=help>
List-Subscribe: <https://lists.gnu.org/mailman/listinfo/emacs-devel>,
	<mailto:emacs-devel-request@gnu.org?subject=subscribe>
X-List-Received-Date: Sun, 10 Apr 2016 14:01:30 -0000
Content-Length: 4849
Lines: 120

This is an OpenPGP/MIME signed message (RFC 4880 and 3156)
--Pb3T24QuA6MJiaxIv2t2eSkgJlNRxanfS
Content-Type: multipart/mixed; boundary="mddWSePGO9KjVgEpsVbXRbn189SOr2pTM"
From: =?UTF-8?Q?Cl=c3=a9ment_Pit--Claudel?= <clement.pit@gmail.com>
To: Eli Zaretskii <eliz@gnu.org>
Cc: dev@caliopen.local
Message-ID: <570A5CB0.8070107@gmail.com>
Subject: Re: How do I set up font fallback in a robust way?
References: <570954AA.7070604@gmail.com> <834mbain03.fsf@gnu.org>
 <57095F97.4060305@gmail.com> <83y48mgp1x.fsf@gnu.org>
In-Reply-To: <83y48mgp1x.fsf@gnu.org>

--mddWSePGO9KjVgEpsVbXRbn189SOr2pTM
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: quoted-printable

On 04/09/2016 10:44 PM, Eli Zaretskii wrote:
>> Cc: dev@caliopen.local From: Cl=C3=A9ment Pit--Claudel=20
>> <clement.pit@gmail.com> Date: Sat, 9 Apr 2016 16:01:27 -0400
>>=20
>> On 04/09/2016 03:46 PM, Eli Zaretskii wrote:
>>> The default fontset already defines specific blocks to be
>>> handled by these fonts, see fontset.el.  What problems,
>>> specifically, do you have with the default setup and the current
>>> emacs-25 branch?
>>=20
>> I get relatively inconsistent results in terms of which font is=20
>> chosen to display a given symbol.
>=20
> I don't think I understand well enough what that means.  This issue=20
> must be dealt with by presenting specific examples.

Sorry, I think I must not have described this problem properly in my init=
ial message. Please let me find a good example.

In any case, here is something I came across while trying to produce one:=


In emacs -Q, insert the following in the *scratch* buffer:

    (set-fontset-font "fontset-default" 'unicode (font-spec :name "Ubuntu=
 Mono") nil)
    (set-fontset-font "fontset-default" 'unicode (font-spec :name "FreeMo=
no") nil 'append)
    (set-fontset-font "fontset-default" 'unicode (font-spec :name "Symbol=
a") nil 'append)

    (insert "=E2=84=95=F0=9D=93=9F=E2=A7=BA=C3=97=E2=89=A0=E2=89=A5=E2=89=
=A4=C2=B1=C2=AC=E2=88=A8=E2=88=A7=E2=88=83=E2=88=80=CE=BB=E2=9F=BF=E2=9F=B9=
=E2=8A=A5=E2=8A=A4=E2=8A=A2")

Now run the lines one by one, and observe the "(insert ...)" line. Before=
 running anything, it looks fine. It still looks fine after running the f=
irst line. Running the second line causes the =F0=9D=93=9F to disappear; =
it is replaced by a square containing 01D4DF, and C-u C-x =3D says "displ=
ay: no font available". Finally, running the third line fixes the =F0=9D=93=
=9F.

I don't understand how this is possible. How can adding FreeMono cause Em=
acs to think that no font is available to display the =F0=9D=93=9F?

>> Is it enough to augment the default fontset? Changing the :height=20
>> of the 'default font creates a new fontset, which doesn't respect=20
>> the fallbacks that I configure.
>=20
> Again, please provide specific examples, because I don't think I=20
> understand how changing height could get in the way.

Same here; I need to find a good example. I ran into issues that seemed t=
o be connected with the fact that (set-face-attribute 'default nil :heigh=
t 120) creates a new fontset, as reported by fontset-list:

    (fontset-list)
    =3D> ("-unknown-Ubuntu Mono-normal-normal-normal-*-15-*-*-*-m-0-fonts=
et-startup" "-*-fixed-medium-r-normal-*-16-*-*-*-*-*-fontset-standard" "-=
*-*-*-*-*-*-*-*-*-*-*-*-fontset-default")

    (set-face-attribute 'default nil :height 120)
    =3D> nil

    (fontset-list)
    =3D> ("-unknown-Ubuntu Mono-normal-normal-normal-*-16-*-*-*-m-0-fonts=
et-auto1" "-unknown-Ubuntu Mono-normal-normal-normal-*-15-*-*-*-m-0-fonts=
et-startup" "-*-fixed-medium-r-normal-*-16-*-*-*-*-*-fontset-standard" "-=
*-*-*-*-*-*-*-*-*-*-*-*-fontset-default")




Thanks for your help,
Cl=C3=A9ment.


--mddWSePGO9KjVgEpsVbXRbn189SOr2pTM--

--Pb3T24QuA6MJiaxIv2t2eSkgJlNRxanfS
Content-Type: application/pgp-signature; name="signature.asc"
Content-Description: OpenPGP digital signature
Content-Disposition: attachment; filename="signature.asc"

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.22 (GNU/Linux)

iQIcBAEBAgAGBQJXClyxAAoJEPqg+cTm90wjh00QAJ/iPXUjmtS8oJ4l3JyCAlph
MH6E4OFOZVT6tCSKy93dSYpT+cEzhcLggYTI97mYWLRB8zJ4LIL1EUgSmPUBl65s
jOSez4fLb2s5n/cSi1p9QwnKNYSddH8yxzZ2AceB1WtJ5SY065sOplz7wGkz++56
ffpiI+4fD4kiHFMI+s80WEGN3faG+cbp2SYWBDFzmsucd2LYlbpqyLpAxd3aKGq6
FeWQwOe1jZQdiw11rxIL9InBSZ2VYnk6745D5Vlu5N2/Qw8DiTMSfsW+AN6FH3Mv
6abZq4NrakC2V81ZFjK98jtqG+TDM9H/uCc7D6Zi43cpD/3Yx3YibAQSs2eU+Owo
43/66FPgdEqPmYPsNXQjBnrrh3B13dDmrOupTcKssCtlx+2BUcTCXuZ5WArJQ37s
cW/auOMTLd+cX7W9FOhQ8xjNUbr81yo1kw4E+F4xiSKn5twMASvA+yCuw6zmmnxW
KdsclCJf9d9pxX2BZrxzBcPnCVfNR/RqM58zYotDHwMpweSgmXZEuwrVW94AF/fF
Nfgg1J2Y081rThyVDRE6+DpxMjYZLuCg0/Ky1U/LWj4wfH7x7qomyg/ySERdI8Ch
yR9VgHYcb+sXArBET+66Y7hL8ViRANPsFwT59hP7Vioc+5lBGDv5pxLwPmvhoNMz
SphIdVtNp92/FuWfuR5S
=943O
-----END PGP SIGNATURE-----

--Pb3T24QuA6MJiaxIv2t2eSkgJlNRxanfS--

